#include <iostream>//biblioteca de input output
#include <vector>//biblioteca de vectores
#include <fstream>//manejo de archivos
#include <sstream>//manejo de strings
#include <string>//declaración de strings

using namespace std;

void imprimirMatriz(const vector<vector<int>>& matriz, const string& nombre) {
    cout<<endl<< "Resultado de " << nombre <<endl;
    //check de matriz vacía
    if (matriz.empty() || (matriz.size() > 0 && matriz[0].empty())) {
        cout << "Matriz vacía"<<endl;
        return;//no retorna nada
    }
    for (const auto& fila:matriz) {
        for (int elemento:fila) {
            cout <<elemento<<"\t";
        }
        cout<<endl;
    }
}

bool leerMatricesDesdeArchivo(const string& nombreArchivo, vector<vector<int>>& BM, vector<vector<int>>& Testores) {
    ifstream archivo(nombreArchivo);
    if (!archivo.is_open()) {
        cerr << "Error: No se pudo abrir el archivo de matrices: " << nombreArchivo << endl;
        return false;
    }

    string linea;
    bool leyendoBM = true;

    while (leyendoBM && getline(archivo, linea)) {
        if (linea.empty() || linea.find_first_not_of(" \t\n\r") == string::npos) {
            leyendoBM = false; 
            continue;
        }
        
        stringstream ss(linea);
        int valor;
        vector<int> fila;
        
        while (ss >> valor) {
            fila.push_back(valor);
        }
        if (!fila.empty()) {
            BM.push_back(fila);
        }
    }

    while (getline(archivo, linea)) {
        if (linea.empty() || linea.find_first_not_of(" \t\n\r") == string::npos) {
            continue;
        }

        stringstream ss(linea);
        int valor;
        vector<int> fila;
        
        while (ss >> valor) {
            fila.push_back(valor);
        }
        if (!fila.empty()) {
            Testores.push_back(fila);
        }
    }

    return true;
}

vector<vector<int>> concatenacion(vector<vector<int>>& BM, vector<vector<int>>& Testores) {
    if (BM.size() != Testores.size()) {
        cerr << "Error (Concatenacion): Las matrices deben tener el mismo número de filas." << endl;
        return {};
    }

    int filas = BM.size();
    vector<vector<int>> concatenada(filas);

    for (int i = 0; i < filas; i++) {
        concatenada[i].insert(concatenada[i].end(), BM[i].begin(), BM[i].end());
        concatenada[i].insert(concatenada[i].end(), Testores[i].begin(), Testores[i].end());
    }
    return concatenada;
}

vector<vector<int>> fusionCombinatoria(vector<vector<int>>& BM, vector<vector<int>>& Testores) {
    vector<vector<int>> resultado;

    for (const auto& filaBM : BM) {
        for (const auto& filaTestores : Testores) {
            
            vector<int> filaNueva;
            
            filaNueva.insert(filaNueva.end(), filaBM.begin(), filaBM.end());
            filaNueva.insert(filaNueva.end(), filaTestores.begin(), filaTestores.end());
            
            resultado.push_back(filaNueva);
        }
    }
    return resultado;
}

vector<vector<int>> operadorDiagonal(vector<vector<int>>& BM, vector<vector<int>>& Testores) {
    int filasBM = BM.size();
    int columnasBM = (filasBM > 0) ? BM[0].size() : 0; 

    int filasTestores = Testores.size();
    int columnasTestores = (filasTestores > 0) ? Testores[0].size() : 0;

    vector<vector<int>> resultado(
        filasBM + filasTestores, 
        vector<int>(columnasBM + columnasTestores, 0)
    );

    for (int i = 0; i < filasBM; i++) {
        for (int j = 0; j < columnasBM; j++) {
            resultado[i][j] = BM[i][j];
        }
    }

    for (int i = 0; i < filasTestores; i++) {
        for (int j = 0; j < columnasTestores; j++) {
            resultado[i + filasBM][j + columnasBM] = Testores[i][j];
        }
    }

    return resultado;
}

int main() {
    vector<vector<int>> BM;
    vector<vector<int>> Testores;
    const string nombreArchivo = "matrices.txt";

    cout << "Iniciando lectura de matrices desde " << nombreArchivo << "..."<<endl;

    if (!leerMatricesDesdeArchivo(nombreArchivo, BM, Testores)) {
        return 1; 
    }

    imprimirMatriz(BM, "Matriz BM Leida");
    imprimirMatriz(Testores, "Matriz Testores Leida");
    
    vector<vector<int>> resConcatenacion = concatenacion(BM, Testores);
    imprimirMatriz(resConcatenacion, "1. Concatenacion");

    vector<vector<int>> resFusion = fusionCombinatoria(BM, Testores);
    imprimirMatriz(resFusion, "2. Fusion Combinatoria");

    vector<vector<int>> resDiagonal = operadorDiagonal(BM, Testores);
    imprimirMatriz(resDiagonal, "3. Operador Diagonal");

    return 0;
}


